(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-129327dd"],{1658:function(t,e,r){},"1e41":function(t,e,r){"use strict";r("7710")},"5d96":function(t,e,r){"use strict";r("1658")},"5dca":function(t,e,r){"use strict";var a=r("9139"),s=(r("6c00"),r("d41b"),r("b8fb")),n=r.n(s),i=r("0481"),o=r("bd40"),c={name:"FilterModal",props:{},computed:{isFilterModalOpened:function(){return this.$store.state.filter.isFilterModalOpened},currFilterType:function(){return this.$store.state.filter.currFilterType},stageList:function(){return this.$store.state.stage.stageList},currStage:function(){return this.$store.state.stage.currStage},stateFilter:function(){return this.$store.getters["filter/stateFilter"]},memberList:function(){return this.$store.state.team.currProjectMemberList},currListType:function(){return this.$store.state.task.currListType}},data:function(){return{currFilter:{},labelCol:{span:6},wrapperCol:{span:14},other:"",dateFormat:"YYYY/MM/DD",form:{member:[],stage:[],rank:[],state:[],name:"",start:"",end:""},formatForm:{}}},watch:{"$store.state.filter.currEditFilter":{handler:function(t){this.currFilter=n()(t)},immediate:!0}},created:function(){},methods:{closeFilter:function(){this.$store.commit("filter/SET_FILTER_MODAL_STATUS",!1)},handleOk:function(){this.$store.commit("filter/SET_FILTER_MODAL_STATUS",!1)},onSubmit:function(){var t=this;return Object(a.a)(regeneratorRuntime.mark((function e(){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.formatForm=n()(t.form),!t.formatForm.start||!t.formatForm.end){e.next=5;break}if(!(t.formatForm.start-t.formatForm.end>0)){e.next=5;break}return t.$message.warning("截止时间早于开始时间！"),e.abrupt("return",!1);case 5:return t.formatForm.start&&(t.formatForm.start=Object(i.b)(t.formatForm.start.format("YYYY-MM-DD h:m:s"))),t.formatForm.end&&(t.formatForm.end=Object(i.b)(t.formatForm.end.format("YYYY-MM-DD h:m:s"))),"bug"===t.currListType?t.formatForm.t_type=0:"task"===t.currListType&&(t.formatForm.t_type=1),e.next=10,Object(o.d)(t.formatForm);case 10:return r=e.sent,a=r.data,t.$store.commit("task/SET_TASK_LIST",a),t.$message.success("列表已更新！"),t.closeFilter(),t.form={member:[],stage:[],rank:[],state:[],name:"",start:"",end:""},e.abrupt("return",!0);case 17:case"end":return e.stop()}}),e)})))()},resetForm:function(){this.$refs.ruleForm.resetFields(),this.form={member:[],stage:[],rank:[],state:[],name:"",start:"",end:""}}}},l=r("2ca5"),u=Object(l.a)(c,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("a-modal",{attrs:{visible:t.isFilterModalOpened,title:"筛选"},on:{cancel:t.closeFilter,ok:t.onSubmit}},[r("template",{slot:"footer"},[r("a-button",{key:"back",on:{click:t.resetForm}},[t._v(" 重置 ")]),r("a-button",{key:"submit",attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v(" 筛选 ")])],1),r("a-form-model",{ref:"ruleForm",attrs:{model:t.form,"label-col":t.labelCol,"wrapper-col":t.wrapperCol}},[r("a-form-model-item",{ref:"name",attrs:{label:"标题",prop:"name"}},[r("a-input",{attrs:{placeholder:"请输入标题"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),"stage"!==t.currFilterType?r("a-form-model-item",{attrs:{label:"负责人"}},[r("a-select",{attrs:{mode:"multiple",placeholder:"点击选择负责人"},model:{value:t.form.member,callback:function(e){t.$set(t.form,"member",e)},expression:"form.member"}},t._l(t.memberList,(function(e){return r("a-select-option",{key:e.uid,attrs:{value:e.name}},[t._v(" "+t._s(e.name)+" ")])})),1)],1):t._e(),"stage"!==t.currFilterType?r("a-form-model-item",{attrs:{label:"迭代",prop:"stage"}},[r("a-select",{attrs:{mode:"multiple",placeholder:"点击选择迭代"},model:{value:t.form.stage,callback:function(e){t.$set(t.form,"stage",e)},expression:"form.stage"}},t._l(t.stageList,(function(e){return r("a-select-option",{key:e.id,attrs:{value:e.id}},[t._v(" "+t._s(e.name)+" ")])})),1)],1):t._e(),r("a-form-model-item",{attrs:{label:"起止日期",prop:"date"}},[r("a-date-picker",{staticStyle:{width:"100%"},attrs:{format:t.dateFormat,type:"date",placeholder:"开始日期"},model:{value:t.form.start,callback:function(e){t.$set(t.form,"start",e)},expression:"form.start"}}),r("a-date-picker",{staticStyle:{width:"100%"},attrs:{format:t.dateFormat,type:"date",placeholder:"截止日期"},model:{value:t.form.end,callback:function(e){t.$set(t.form,"end",e)},expression:"form.end"}})],1),"task"===t.currListType?r("a-form-item",{attrs:{label:"状态"}},[r("a-select",{attrs:{mode:"multiple",placeholder:"点击选择状态"},model:{value:t.form.state,callback:function(e){t.$set(t.form,"state",e)},expression:"form.state"}},t._l(t.stateFilter,(function(e){return r("a-select-option",{key:e,attrs:{value:e}},[t._v(" "+t._s(e)+" ")])})),1)],1):t._e(),r("a-form-item",{attrs:{label:"优先级"}},[r("a-select",{attrs:{mode:"multiple",placeholder:"点击选择优先级"},model:{value:t.form.rank,callback:function(e){t.$set(t.form,"rank",e)},expression:"form.rank"}},[r("a-select-option",{attrs:{value:"2"}},[t._v(" 普通 ")]),r("a-select-option",{attrs:{value:"1"}},[t._v(" 紧急 ")]),r("a-select-option",{attrs:{value:"0"}},[t._v(" 非常紧急 ")])],1)],1)],1)],2)],1)}),[],!1,null,null,null);e.a=u.exports},"72e5":function(t,e,r){"use strict";r.r(e);var a=r("c208"),s=r("159c"),n=r("9139"),i=(r("471a"),r("048d")),o=(r("6c00"),r("4a34"),r("fecb"),r("ef25"),r("e308"),r("9856"),r("0a9c"),r("f690"),r("1cdc"),r("bd40")),c=r("04ff"),l=r("8c48"),u=r("9685"),d=r("99dd"),m=r("89b9"),f=r("6f42"),_=r("5dca"),p={name:"TaskList",components:{Task:f.a,FilterModal:_.a,AddModal:m.a},data:function(){var t=this;return{columns:[{dataIndex:"t_title",key:"t_title",ellipsis:!0,width:"400px",slots:{title:"all"},scopedSlots:{filterDropdown:"filterDropdown",filterIcon:"filterIcon",customRender:"task"},onFilter:function(t,e){return e.task.children.task.toString().toLowerCase().includes(t.toLowerCase())},onFilterDropdownVisibleChange:function(e){e&&setTimeout((function(){t.searchInput.focus()}),0)}},{title:"ID",dataIndex:"id",key:"id",scopedSlots:{customRender:"id"},width:"90px"},{title:"优先级",dataIndex:"t_rank",key:"t_rank",width:"100px",defaultSortOrder:"descend",sorter:function(t,e){return t.t_rank-e.t_rank},scopedSlots:{customRender:"rank"}},{title:"迭代",key:"t_stage_name",width:"80px",dataIndex:"t_stage_name"},{title:"状态",dataIndex:"t_state",width:"80px",key:"t_state",scopedSlots:{customRender:"state"}},{title:"处理人",dataIndex:"t_header_name",key:"t_header_name",scopedSlots:{filterDropdown:"filterDropdown",filterIcon:"filterIcon",customRender:"member"},onFilter:function(t,e){return e.member.children.t_header_name.toString().toLowerCase().includes(t.toLowerCase())},onFilterDropdownVisibleChange:function(e){e&&setTimeout((function(){t.searchInput.focus()}),0)}},{title:"预计开始",dataIndex:"start_time",key:"start_time",scopedSlots:{customRender:"start"}},{title:"预计结束",dataIndex:"end_time",key:"end_time",scopedSlots:{customRender:"end"}},{title:"操作",key:"action",width:"50px",scopedSlots:{customRender:"action"}}],expandRows:[],isExpandAll:!1,showTask:!1,loading:!1,isTodoMenuOpened:!0,searchText:"",searchInput:null,searchedColumn:"",selectedRowKeys:[],typeDict:[],clickRowId:"",selectValue:["china"],treeLoading:!1,simpleImage:i.a.PRESENTED_IMAGE_SIMPLE,nouseData:"",detailTaskId:"",dialogList:{},detail:{}}},created:function(){this.getTask(),this.getMemberList()},computed:{data:function(){return this.$store.state.task.taskList},currProjectID:function(){return this.$store.state.project.currProjectId},isAddModalOpened:function(){return this.$store.state.add.isAddModalOpened},currListType:function(){return this.$store.state.task.currListType},currStageId:function(){return this.$store.state.stage.currStageId}},watch:{currProjectID:function(){this.getTask()},showTask:function(){this.getTask()},isAddModalOpened:function(){this.getTask()},currListType:function(){this.getTask()},currStageId:function(){this.getTask()}},methods:{closeDetail:function(){this.showTask=!1},getStageList:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var r,a,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.currProjectID,e.next=3,Object(u.c)(r);case 3:return a=e.sent,s=a.data,t.$store.commit("stage/SET_STAGE_LIST",s.stagelist),e.abrupt("return",!0);case 7:case"end":return e.stop()}}),e)})))()},getMemberList:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var r,a,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.currProjectID,e.next=3,Object(d.a)(r);case 3:a=e.sent,s=a.data,t.$store.commit("team/SET_CURR_PROJECT_MEMBER_LIST",s);case 6:case"end":return e.stop()}}),e)})))()},getTask:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var r,a,s,n,i,c,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.currProjectID,a=t.currStageId,"stage"!==t.currListType){e.next=10;break}return e.next=5,Object(o.g)(r,a);case 5:s=e.sent,n=s.data,t.$store.commit("task/SET_TASK_LIST",n),e.next=16;break;case 10:return i="task"===t.currListType?1:0,e.next=13,Object(o.i)(r,i);case 13:c=e.sent,l=c.data,t.$store.commit("task/SET_TASK_LIST",l);case 16:return e.abrupt("return",!0);case 17:case"end":return e.stop()}}),e)})))()},deleteTask:function(t){var e=this;return Object(n.a)(regeneratorRuntime.mark((function r(){var a;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,Object(o.b)(t);case 3:a=r.sent,e.$message.success(a.meta.msg),e.getTask(),r.next=10;break;case 8:r.prev=8,r.t0=r.catch(0);case 10:return r.abrupt("return",!0);case 11:case"end":return r.stop()}}),r,null,[[0,8]])})))()},logOut:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$store.dispatch("user/logout");case 2:e.sent&&(t.$message.success("成功退出"),t.$router.replace({name:"Login"}));case 4:case"end":return e.stop()}}),e)})))()},nouse:function(){},onSelectChange:function(t){this.selectedRowKeys=t},clearSele:function(){this.selectedRowKeys=[]},handleSearch:function(t,e,r){e();var a=Object(s.a)(t,1)[0];this.searchText=a,this.searchedColumn=r},handleReset:function(t){t(),this.searchText=""},onCellChange:function(t,e,r){var s=Object(a.a)(this.dataSource),n=s.find((function(e){return e.key===t}));n&&(n[e]=r,this.dataSource=s)},expandAllRow:function(){this.isExpandAll=!0;for(var t=[],e=Object(a.a)(this.data),r=0;r<e.length;r+=1){var s=e[r];if(void 0!==s.children){t.push("".concat(s.id));for(var n=0;n<s.children.length;n+=1){var i=s.children[n];void 0!==i.children&&t.push("".concat(i.id))}}}this.expandRows=t},closeAllRow:function(){this.isExpandAll=!1,this.expandRows=[]},expandRowIcon:function(t){var e=this,r=this.$createElement;if(void 0!==t.record.children&&t.record.children.length>0){var a=t.record.id;return t.expanded?r("div",{class:"expand-icon",on:{click:function(){for(var t=0;t<e.expandRows.length;t+=1)"".concat(a)===e.expandRows[t]&&e.expandRows.splice(t,1)}}},["-"]):r("div",{class:"expand-icon",on:{click:function(){e.expandRows.push("".concat(a))}}},["+"])}return r("span",{style:"margin-left:25px"})},customRow:function(t){var e=this;return{style:{},on:{click:function(){e.clickRowId=t.id},mouseenter:function(t){t.currentTarget.style.transform="translateY(-3px)",t.currentTarget.style.boxShadow="0 15px 30px -5px rgba(71, 95, 123, 0.1)",t.currentTarget.style.backgroundColor="#fff",t.currentTarget.style.transition="all 0.3s ease"},mouseleave:function(t){t.currentTarget.style.transform="",t.currentTarget.style.boxShadow=""}}}},rowClass:function(t){return t.id===this.clickRowId?"clickRowColor":""},stateColor:function(t){switch(t){case"规划中":return"pink";case"实现中":return"blue";case"已实现":return"cyan";case"已拒绝":return"purple";case"已验收":return"green";case"已关闭":return"#626262";case"新":return"orange";case"处理中":return"blue";case"已解决":return"green";default:return"#626262"}},onOpenFilter:function(){this.$store.commit("filter/SET_FILTER_MODAL_TYPE","task"),this.$store.commit("filter/SET_FILTER_MODAL_STATUS",!0)},onOpenAdd:function(){this.$store.commit("add/SET_ADD_FROM_DETAIL",!1),this.$store.commit("add/SET_ADD_MODAL_TYPE","task"),this.$store.commit("add/SET_ADD_MODAL_STATUS",!0)},resetTable:function(){this.getTask()},getTaskDetail:function(t){var e=this;return Object(n.a)(regeneratorRuntime.mark((function r(){var a,s,n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=e.currProjectID,r.next=3,Object(o.h)(a,t);case 3:return s=r.sent,n=s.data,e.$store.commit("task/SET_TASK_DETAIL",n),0!==n.detail.t_level&&e.$store.commit("task/SET_CURR_FATHER_TASK",n.parent[0]),r.abrupt("return",!0);case 8:case"end":return r.stop()}}),r)})))()},getDialog:function(t){var e=this;return Object(n.a)(regeneratorRuntime.mark((function r(){var a,s,n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a={pid:e.currProjectID,source:"task",sid:t},r.next=3,Object(l.a)(a);case 3:return s=r.sent,n=s.data,e.$store.commit("task/SET_TASK_DIALOG",n),r.abrupt("return",!0);case 7:case"end":return r.stop()}}),r)})))()},getComment:function(t){var e=this;return Object(n.a)(regeneratorRuntime.mark((function r(){var a,s,n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a={source:"task",sid:t},r.next=3,Object(c.a)(a);case 3:return s=r.sent,n=s.data,e.$store.commit("task/SET_TASK_COMMENT",n),r.abrupt("return",!0);case 7:case"end":return r.stop()}}),r)})))()},showDetail:function(t){var e=this;return Object(n.a)(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return e.$store.commit("task/SET_CURR_EDIT_TASK",t),r.next=3,e.getTaskDetail(t);case 3:return r.next=5,e.getDialog(t);case 5:return r.next=7,e.getComment(t);case 7:e.showTask=!0;case 8:case"end":return r.stop()}}),r)})))()}}},g=(r("1e41"),r("2ca5")),h=Object(g.a)(p,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"todo-app"},[r("div",[r("div",{staticClass:"relative flex flex-no-wrap task-list mt-3 pl-6"},[r("h3",{staticClass:"section-card__title"},[t._v(t._s("stage"===t.currListType?"迭代任务":"task"===t.currListType?"需求管理":"缺陷管理"))]),r("div",{staticClass:"flex ml-auto"},[r("a-button",{staticClass:"ml-1 w-30 flex ",attrs:{type:"primary"},on:{click:function(e){return t.onOpenAdd()}}},[r("feather",{staticClass:"mr-1 mt-1",attrs:{size:"20",type:"plus"}}),t._v(" 新增"+t._s("task"===t.currListType||"stage"===t.currListType?"需求":"缺陷")+" ")],1),r("a-button",{staticClass:"ml-1 mr-4 flex",on:{click:function(e){return t.onOpenFilter()}}},[r("feather",{staticClass:"mr-1",attrs:{size:"18",type:"search"}}),t._v(" 筛选")],1),r("a-button",{staticClass:"ml-1 mr-4 flex",on:{click:function(e){return t.resetTable()}}},[r("feather",{staticClass:"mr-1 ",attrs:{size:"18",type:"refresh-cw"}}),t._v(" 清除筛选")],1)],1),r("div",{staticClass:"mr-4"},[r("a-dropdown",[r("a-button",[t._v("更多操作"),r("a-icon",{attrs:{type:"down"}})],1),r("a-menu",{attrs:{slot:"overlay"},slot:"overlay"},[r("a-menu-item",[r("a",[t._v("导入需求")])]),r("a-menu-item",[r("a",[t._v("导出需求")])])],1)],1)],1)]),r("div",[r("a-card",{attrs:{bordered:!1}},[r("a-table",{ref:"table",attrs:{size:"middle",scroll:{y:450},"row-key":function(t){return t.id+""},pagination:!1,"default-expand-all-rows":!1,columns:t.columns,"data-source":t.data,loading:t.loading,"show-pagination":"auto","row-selection":{selectedRowKeys:t.selectedRowKeys,onChange:t.onSelectChange},"expanded-row-keys":t.expandRows,"expand-icon":function(e){return t.expandRowIcon(e)},"custom-row":t.customRow,"row-class-name":t.rowClass},scopedSlots:t._u([{key:"filterDropdown",fn:function(e){var a=e.setSelectedKeys,s=e.selectedKeys,n=e.confirm,i=e.clearFilters,o=e.column;return r("div",{staticStyle:{padding:"8px"}},[r("a-input",{directives:[{name:"ant-ref",rawName:"v-ant-ref",value:function(e){return t.searchInput=e},expression:"c => (searchInput = c)"}],staticStyle:{width:"188px","margin-bottom":"8px",display:"block"},attrs:{placeholder:"查找"+o.t_title,value:s[0]},on:{change:function(t){return a(t.target.value?[t.target.value]:[])},pressEnter:function(){return t.handleSearch(s,n,o.dataIndex)}}}),r("a-button",{staticStyle:{width:"90px","margin-right":"8px"},attrs:{type:"primary",icon:"search",size:"small"},on:{click:function(){return t.handleSearch(s,n,o.dataIndex)}}},[t._v(" 查找 ")]),r("a-button",{staticStyle:{width:"90px"},attrs:{size:"small"},on:{click:function(){return t.handleReset(i)}}},[t._v(" 重置 ")])],1)}},{key:"filterIcon",fn:function(t){return r("a-icon",{style:{color:t?"#108ee9":void 0},attrs:{type:"search"}})}},{key:"task",fn:function(e,a,s,n){return[t.searchText&&t.searchedColumn===n.dataIndex?r("span",{staticClass:"task-pointer",on:{click:function(e){return t.showDetail(a.id)}}},[t._l(e.toString().split(new RegExp("(?<="+t.searchText+")|(?="+t.searchText+")","i")),(function(e,a){return[e.toLowerCase()===t.searchText.toLowerCase()?r("mark",{key:a,staticClass:"highlight"},[t._v(t._s(e))]):[t._v(t._s(e))]]}))],2):[r("span",{staticClass:"task-pointer",on:{click:function(e){return t.showDetail(a.id)}}},["stage"===t.currListType?r("a-tag",{attrs:{color:1===a.t_type?"blue":"red"}},[t._v(" "+t._s(1===a.t_type?"需求":"缺陷")+" ")]):t._e(),t._v(" "+t._s(e)+" ")],1)]]}},{key:"rank",fn:function(e){return r("span",{},[""!==e?r("div",[r("a-tag",{attrs:{color:3===e?"#ff5b5c":2===e?"#fdac41":"#28c175"}},[t._v(" "+t._s(3===e?"非常紧急":2===e?"紧急":"普通")+" ")])],1):t._e()])}},{key:"state",fn:function(e){return r("span",{},[e?r("div",{staticClass:"pr-2"},[r("a-tag",{attrs:{color:t.stateColor(e)}},[t._v(" "+t._s(e)+" ")])],1):r("div",[t._v("-")])])}},{key:"member",fn:function(e,a,s,n){return[t.searchText&&t.searchedColumn===n.dataIndex?r("span",[t._l(e.toString().split(new RegExp("(?<="+t.searchText+")|(?="+t.searchText+")","i")),(function(e,a){return[e.toLowerCase()===t.searchText.toLowerCase()?r("mark",{key:a,staticClass:"highlight"},[t._v(t._s(e))]):[t._v(t._s(e))]]}))],2):[r("span",[t._v(t._s(e))])]]}},{key:"start",fn:function(e){return r("span",{staticStyle:{"text-align":"center"}},[e?[t._v(" "+t._s(t._f("dateFormat")(e))+" ")]:[t._v(" - ")]],2)}},{key:"end",fn:function(e){return r("span",{staticStyle:{"text-align":"center"}},[e?[t._v(" "+t._s(t._f("dateFormat")(e))+" ")]:[t._v(" - ")]],2)}},{key:"action",fn:function(e){return r("span",{staticStyle:{"text-align":"center"}},[[r("a-popconfirm",{attrs:{placement:"topRight",title:"删除本菜单与下级？"},on:{confirm:function(r){return t.deleteTask(e.id)}}},[r("a-icon",{staticClass:"cursor-pointer",attrs:{type:"delete",theme:"twoTone","two-tone-color":"#ea2e47"}})],1)]],2)}}])},[r("span",{staticStyle:{"margin-right":"5px"},attrs:{slot:"all"},slot:"all"},[r("div",{directives:[{name:"show",rawName:"v-show",value:!t.isExpandAll,expression:"!isExpandAll"}],staticClass:"expand-icon",on:{click:t.expandAllRow}},[t._v(" + ")]),r("div",{directives:[{name:"show",rawName:"v-show",value:t.isExpandAll,expression:"isExpandAll"}],staticClass:"expand-icon",on:{click:t.closeAllRow}},[t._v(" - ")]),t._v(" 任务")])])],1)],1),r("task",{attrs:{"pop-visible":t.showTask,detail:"detailTaskId"},on:{close:t.closeDetail}}),r("filter-modal"),r("add-modal")],1)])}),[],!1,null,"45cdbc18",null);e.default=h.exports},7710:function(t,e,r){},"89b9":function(t,e,r){"use strict";var a=r("9139"),s=(r("6c00"),r("b8fb")),n=r.n(s),i=r("0481"),o=r("bd40"),c=r("9685"),l={name:"AddModal",props:{},computed:{isAddModalOpened:function(){return this.$store.state.add.isAddModalOpened},stageList:function(){return this.$store.state.stage.stageList},currStage:function(){return this.$store.state.stage.currStage},currStageId:function(){return this.$store.state.stage.currStageId},stateAdd:function(){return this.$store.getters["add/stateAdd"]},memberList:function(){return this.$store.state.team.currProjectMemberList},currProjectID:function(){return this.$store.state.project.currProjectId},currEditTask:function(){return this.$store.state.task.currEditTask},openFrom:function(){return this.$store.state.add.isFromDetail},currEditTaskLevel:function(){return this.$store.state.task.currEditTaskLevel},currListType:function(){return this.$store.state.task.currListType},currAddType:function(){return this.$store.state.add.currAddType}},data:function(){return{currAdd:{},labelCol:{span:6},wrapperCol:{span:14},other:"",dateFormat:"YYYY/MM/DD",form:{t_pid:"",t_level:"",t_title:"",t_stage_id:"",t_stage_name:"",t_project_id:"",t_content:"",t_state:"",t_rank:"",t_header_id:"",t_header_name:"",start_time:"",end_time:""},taskStatus:["规划中","实现中","已实现","已拒绝"],rules:{t_title:[{required:!0,message:"请输入标题",trigger:"blur"}],t_stage_id:[{required:!0,message:"请选择迭代",trigger:"blur"}]},formatForm:{}}},watch:{"$store.state.add.currEditAdd":{handler:function(t){this.currAdd=n()(t)},immediate:!0}},created:function(){this.getStageList()},methods:{getStageList:function(){var t=this;return Object(a.a)(regeneratorRuntime.mark((function e(){var r,a,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.currProjectID,e.next=3,Object(c.c)(r);case 3:return a=e.sent,s=a.data,t.$store.commit("stage/SET_STAGE_LIST",s.stagelist),e.abrupt("return",!0);case 7:case"end":return e.stop()}}),e)})))()},selectHeader:function(t,e){this.form.t_header_id=t,this.form.t_header_name=e},selectStage:function(t,e){this.form.t_stage_id=t,this.form.t_stage_name=e},closeAdd:function(){this.resetForm(),this.$store.commit("add/SET_ADD_MODAL_STATUS",!1)},handleOk:function(){this.resetForm(),this.$store.commit("add/SET_ADD_MODAL_STATUS",!1)},onSubmit:function(){var t=this;return Object(a.a)(regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.formatForm=n()(t.form),!t.formatForm.start_time||!t.formatForm.end_time){e.next=5;break}if(!(t.formatForm.start_time-t.formatForm.end_time>0)){e.next=5;break}return t.$message.warning("截止时间早于开始时间！"),e.abrupt("return",!1);case 5:return t.formatForm.start_time&&(t.formatForm.start_time=Object(i.b)(t.formatForm.start_time.format("YYYY-MM-DD h:m:s"))),t.formatForm.end_time&&(t.formatForm.end_time=Object(i.b)(t.formatForm.end_time.format("YYYY-MM-DD h:m:s"))),t.formatForm.t_project_id=t.currProjectID,t.formatForm.t_pid=!0===t.openFrom?t.currEditTask:0,t.formatForm.t_level=!0===t.openFrom?t.currEditTaskLevel:0,"stage"===t.currListType&&(t.formatForm.t_stage_id=t.currStageId,t.formatForm.t_stage_name=t.currStage),"bug"===t.currAddType?(t.formatForm.t_type=0,t.formatForm.t_state="新"):t.formatForm.t_type=1,e.prev=12,e.next=15,Object(o.a)(t.formatForm);case 15:r=e.sent,r.data,t.$message.success("成功新增需求！"),t.closeAdd(),t.form={t_pid:"",t_level:"",t_title:"",t_stage_id:"",t_stage_name:"",t_project_id:"",t_content:"",t_state:"",t_rank:"",t_header_id:"",t_header_name:"",start_time:"",end_time:""},e.next=24;break;case 22:e.prev=22,e.t0=e.catch(12);case 24:return e.abrupt("return",!0);case 25:case"end":return e.stop()}}),e,null,[[12,22]])})))()},resetForm:function(){this.$refs.ruleForm.resetFields(),this.form={t_pid:"",t_level:"",t_title:"",t_stage_id:"",t_stage_name:"",t_project_id:"",t_content:"",t_state:"",t_rank:"",t_header_id:"",t_header_name:"",start_time:"",end_time:""}}}},u=r("2ca5"),d=Object(u.a)(l,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticStyle:{"z-index":"9999"}},[r("a-modal",{attrs:{visible:t.isAddModalOpened,title:"bug"===t.currAddType?"新增缺陷":"新增需求"},on:{cancel:t.closeAdd,ok:t.onSubmit}},[r("template",{slot:"footer"},[r("a-button",{key:"back",on:{click:t.resetForm}},[t._v(" 重置 ")]),r("a-button",{key:"submit",attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v(" 添加 ")])],1),r("a-form-model",{ref:"ruleForm",attrs:{model:t.form,rules:t.rules,"label-col":t.labelCol,"wrapper-col":t.wrapperCol}},[r("a-form-model-item",{ref:"t_title",attrs:{label:"标题",prop:"t_title"}},[r("a-input",{attrs:{placeholder:"请输入标题"},model:{value:t.form.t_title,callback:function(e){t.$set(t.form,"t_title",e)},expression:"form.t_title"}})],1),r("a-form-model-item",{attrs:{label:"负责人"}},[r("a-select",{attrs:{placeholder:"点击选择负责人"},model:{value:t.form.t_header_name,callback:function(e){t.$set(t.form,"t_header_name",e)},expression:"form.t_header_name"}},t._l(t.memberList,(function(e){return r("a-select-option",{key:e.uid,attrs:{value:e.name},on:{click:function(r){return t.selectHeader(e.uid,e.name)}}},[t._v(" "+t._s(e.name)+" ")])})),1)],1),"stage"!==t.currListType?r("a-form-model-item",{attrs:{label:"迭代",prop:"t_stage_id"}},[r("a-select",{attrs:{placeholder:"点击选择迭代"},model:{value:t.form.t_stage_id,callback:function(e){t.$set(t.form,"t_stage_id",e)},expression:"form.t_stage_id"}},t._l(t.stageList,(function(e){return r("a-select-option",{key:e.s_id,attrs:{value:e.s_id},on:{click:function(r){return t.selectStage(e.s_id,e.s_title)}}},[t._v(" "+t._s(e.s_title)+" ")])})),1)],1):t._e(),r("a-form-model-item",{attrs:{label:"起止日期",prop:"date"}},[r("a-date-picker",{staticStyle:{width:"100%"},attrs:{format:t.dateFormat,type:"date",placeholder:"开始日期"},model:{value:t.form.start_time,callback:function(e){t.$set(t.form,"start_time",e)},expression:"form.start_time"}}),r("a-date-picker",{staticStyle:{width:"100%"},attrs:{format:t.dateFormat,type:"date",placeholder:"截止日期"},model:{value:t.form.end_time,callback:function(e){t.$set(t.form,"end_time",e)},expression:"form.end_time"}})],1),r("a-form-item",{attrs:{label:"状态"}},[r("a-select",{attrs:{placeholder:"点击选择状态"},model:{value:t.form.t_state,callback:function(e){t.$set(t.form,"t_state",e)},expression:"form.t_state"}},t._l(t.stateAdd,(function(e){return r("a-select-option",{key:e,attrs:{value:e}},[t._v(" "+t._s(e)+" ")])})),1)],1),r("a-form-item",{attrs:{label:"优先级"}},[r("a-select",{attrs:{placeholder:"点击选择优先级"},model:{value:t.form.t_rank,callback:function(e){t.$set(t.form,"t_rank",e)},expression:"form.t_rank"}},[r("a-select-option",{attrs:{value:"1"}},[t._v(" 普通 ")]),r("a-select-option",{attrs:{value:"2"}},[t._v(" 紧急 ")]),r("a-select-option",{attrs:{value:"3"}},[t._v(" 非常紧急 ")])],1)],1)],1)],2)],1)}),[],!1,null,null,null);e.a=d.exports},9169:function(t,e,r){},9685:function(t,e,r){"use strict";r.d(e,"c",(function(){return s})),r.d(e,"b",(function(){return n})),r.d(e,"d",(function(){return i})),r.d(e,"e",(function(){return o})),r.d(e,"a",(function(){return c}));var a=r("4de3");function s(t){return Object(a.a)({url:"/stage/all/".concat(t),method:"get"})}function n(t){return Object(a.a)({url:"/stage/".concat(t),method:"get"})}function i(t){return Object(a.a)({url:"/stage/new",method:"post",data:t})}function o(t){return Object(a.a)({url:"/stage/update",method:"put",data:t})}function c(t){return Object(a.a)({url:"/stage/delete",method:"delete",data:t})}},bbf8:function(t,e,r){"use strict";r("9169")},e5da:function(t,e,r){"use strict";r.r(e);var a=r("9139"),s=(r("1cdc"),r("e2ca"),r("e937"),r("d41b"),r("6c00"),r("cf67")),n=r.n(s),i=r("89b9"),o=r("d4ee"),c=r.n(o),l=r("9685"),u=r("bd40"),d=r("04ff"),m=r("8c48"),f=r("99dd"),_=r("0481"),p=(r("b8fb"),r("6f42")),g=r("5dca"),h={components:{draggable:n.a,AddModal:i.a,Task:p.a},data:function(){return{name:"MemberRes",data:[],columns:[{title:"处理人",dataIndex:"name",scopedSlots:{customRender:"name"}},{title:"规划中",dataIndex:"data[0]",key:"data[0].id",width:"22%",scopedSlots:{customRender:"plan"}},{title:"实现中",dataIndex:"data[1]",key:"data[1].id",width:"22%",scopedSlots:{customRender:"develop"}},{title:"已实现",dataIndex:"data[2]",key:"data[2].id",width:"22%",scopedSlots:{customRender:"finish"}},{title:"已拒绝",dataIndex:"data[3]",key:"data[3].id",width:"22%",scopedSlots:{customRender:"reject"}}],dragOptions:{animation:200,group:"description",disabled:!0,ghostClass:"ghost"},showTask:!1}},watch:{showTask:function(){this.init()},isAddModalOpened:function(){this.init()}},created:function(){this.init()},methods:{onOpenAdd:function(){this.$store.commit("add/SET_ADD_FROM_DETAIL",!1),this.$store.commit("add/SET_ADD_MODAL_TYPE","task"),this.$store.commit("add/SET_ADD_MODAL_STATUS",!0)},init:function(){this.getMemberBoard()},getMemberBoard:function(){var t=this;return Object(a.a)(regeneratorRuntime.mark((function e(){var r,a,s,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.currProjectID,a=t.currStageId,e.next=4,Object(u.f)(r,a);case 4:s=e.sent,n=s.data,t.data=n;case 7:case"end":return e.stop()}}),e)})))()},rankColor:function(t,e){if(t)return"side-menu-icon-color";switch(e){case 1:return"success";case 2:return"warning";case 3:return"danger";default:return"primary"}},showDetail:function(t){var e=this;return Object(a.a)(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return e.$store.commit("task/SET_CURR_EDIT_TASK",t),r.next=3,e.getTaskDetail(t);case 3:return r.next=5,e.getDialog(t);case 5:return r.next=7,e.getComment(t);case 7:e.showTask=!0;case 8:case"end":return r.stop()}}),r)})))()},getComment:function(t){var e=this;return Object(a.a)(regeneratorRuntime.mark((function r(){var a,s,n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a={source:"task",sid:t},r.next=3,Object(d.a)(a);case 3:return s=r.sent,n=s.data,e.$store.commit("task/SET_TASK_COMMENT",n),r.abrupt("return",!0);case 7:case"end":return r.stop()}}),r)})))()},getMemberList:function(){var t=this;return Object(a.a)(regeneratorRuntime.mark((function e(){var r,a,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.currProjectID,e.next=3,Object(f.a)(r);case 3:a=e.sent,s=a.data,t.$store.commit("team/SET_CURR_PROJECT_MEMBER_LIST",s);case 6:case"end":return e.stop()}}),e)})))()},getTaskDetail:function(t){var e=this;return Object(a.a)(regeneratorRuntime.mark((function r(){var a,s,n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=e.currProjectID,r.next=3,Object(u.h)(a,t);case 3:return s=r.sent,n=s.data,e.$store.commit("task/SET_TASK_DETAIL",n),0!==n.detail.t_level&&e.$store.commit("task/SET_CURR_FATHER_TASK",n.parent[0]),r.abrupt("return",!0);case 8:case"end":return r.stop()}}),r)})))()},getDialog:function(t){var e=this;return Object(a.a)(regeneratorRuntime.mark((function r(){var a,s,n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a={pid:e.currProjectID,source:"task",sid:t},r.next=3,Object(m.a)(a);case 3:return s=r.sent,n=s.data,e.$store.commit("task/SET_TASK_DIALOG",n),r.abrupt("return",!0);case 7:case"end":return r.stop()}}),r)})))()}},computed:{currProjectID:function(){return this.$store.state.project.currProjectId},currStage:function(){return this.$store.state.stage.currStage},currStageId:function(){return this.$store.state.stage.currStageId},isAddModalOpened:function(){return this.$store.state.add.isAddModalOpened}}},b=(r("5d96"),r("2ca5")),k=Object(b.a)(h,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"member"},[r("div",[r("div",{staticClass:"relative flex flex-no-wrap task-list mt-3 pl-6"},[r("h3",{staticClass:"section-card__title"},[t._v("成员任务跟踪")]),r("a-button",{staticClass:"ml-1 w-30 flex ",attrs:{type:"primary"},on:{click:function(e){return t.onOpenAdd()}}},[r("feather",{staticClass:"mr-1 ",attrs:{size:"20",type:"plus"}}),t._v(" 新增 ")],1),r("div",{staticClass:"flex ml-auto"})],1),r("div",[r("a-card",{attrs:{bordered:!1}},[r("a-table",{attrs:{columns:t.columns,"data-source":t.data,bordered:"",scroll:{x:1200,y:400},pagination:!1},scopedSlots:t._u([{key:"name",fn:function(e){return[r("div",{staticStyle:{"text-align":"center",margin:"auto"}},[r("a-avatar",{staticClass:"flex-wrap text-xs primary bg-primary-light",attrs:{size:60}},[t._v(t._s(e))]),r("div",{staticClass:"flex-wrap pt-2"},[t._v(t._s(e))])],1)]}},{key:"plan",fn:function(e){return[r("div",{staticClass:"kb-col__board"},[r("draggable",t._b({model:{value:e.datalist,callback:function(r){t.$set(e,"datalist",r)},expression:"plan.datalist"}},"draggable",t.dragOptions,!1),[r("transition-group",{attrs:{tag:"ul"}},t._l(e.datalist,(function(e){var a=e.id,s=e.t_title,n=e.t_rank,i=e.t_content,o=e.t_header_name,c=e.end_time,l=e.is_done;return r("li",{key:a,staticClass:"kb-col__item",attrs:{"data-border":t.rankColor(l,n)},on:{click:function(e){return t.showDetail(a)}}},[r("div",{staticClass:"boardItem",class:{done:l},domProps:{innerHTML:t._s(s)}}),r("div",{staticClass:"text-sm text-gray-500 boardItem",class:{done:l}},[t._v(" "+t._s(i)+" ")]),r("div",{staticClass:"mt-1 flex items-center text-xs"},[r("div",{staticClass:"mr-2 flex items-center"},[null!==c?r("feather",{staticClass:"mr-1",attrs:{size:"12",type:"clock"}}):t._e(),null!==c?r("span",[t._v(" "+t._s(t._f("dateFormat")(c)))]):t._e()],1),r("div",{staticClass:"ml-auto flex-1 flex flex-wrap justify-end"},[r("a-avatar",{key:a,staticClass:"kb-col__avatar text-xs primary bg-primary-light",attrs:{size:30}},[t._v(t._s(null===o?"暂无":o))])],1)])])})),0)],1)],1)]}},{key:"develop",fn:function(e){return[r("div",{staticClass:"kb-col__board"},[r("draggable",t._b({model:{value:e.datalist,callback:function(r){t.$set(e,"datalist",r)},expression:"develop.datalist"}},"draggable",t.dragOptions,!1),[r("transition-group",{attrs:{tag:"ul"}},t._l(e.datalist,(function(e){var a=e.id,s=e.t_title,n=e.t_rank,i=e.t_content,o=e.t_header_name,c=e.end_time,l=e.is_done;return r("li",{key:a,staticClass:"kb-col__item",attrs:{"data-border":t.rankColor(l,n)},on:{click:function(e){return t.showDetail(a)}}},[r("div",{staticClass:"boardItem",class:{done:l},domProps:{innerHTML:t._s(s)}}),r("div",{staticClass:"text-sm text-gray-500 boardItem",class:{done:l}},[t._v(" "+t._s(i)+" ")]),r("div",{staticClass:"mt-1 flex items-center text-xs"},[r("div",{staticClass:"mr-2 flex items-center"},[null!==c?r("feather",{staticClass:"mr-1",attrs:{size:"12",type:"clock"}}):t._e(),null!==c?r("span",[t._v(" "+t._s(t._f("dateFormat")(c)))]):t._e()],1),r("div",{staticClass:"ml-auto flex-1 flex flex-wrap justify-end"},[r("a-avatar",{key:a,staticClass:"kb-col__avatar text-xs primary bg-primary-light",attrs:{size:30}},[t._v(t._s(null===o?"暂无":o))])],1)])])})),0)],1)],1)]}},{key:"finish",fn:function(e){return[r("div",{staticClass:"kb-col__board"},[r("draggable",t._b({model:{value:e.datalist,callback:function(r){t.$set(e,"datalist",r)},expression:"finish.datalist"}},"draggable",t.dragOptions,!1),[r("transition-group",{attrs:{tag:"ul"}},t._l(e.datalist,(function(e){var a=e.id,s=e.t_title,n=e.t_rank,i=e.t_content,o=e.t_header_name,c=e.end_time,l=e.is_done;return r("li",{key:a,staticClass:"kb-col__item",attrs:{"data-border":t.rankColor(l,n)},on:{click:function(e){return t.showDetail(a)}}},[r("div",{staticClass:"boardItem",class:{done:l},domProps:{innerHTML:t._s(s)}}),r("div",{staticClass:"text-sm text-gray-500 boardItem",class:{done:l}},[t._v(" "+t._s(i)+" ")]),r("div",{staticClass:"mt-1 flex items-center text-xs"},[r("div",{staticClass:"mr-2 flex items-center"},[null!==c?r("feather",{staticClass:"mr-1",attrs:{size:"12",type:"clock"}}):t._e(),null!==c?r("span",[t._v(" "+t._s(t._f("dateFormat")(c)))]):t._e()],1),r("div",{staticClass:"ml-auto flex-1 flex flex-wrap justify-end"},[r("a-avatar",{key:a,staticClass:"kb-col__avatar text-xs primary bg-primary-light",attrs:{size:30}},[t._v(t._s(null===o?"暂无":o))])],1)])])})),0)],1)],1)]}},{key:"reject",fn:function(e){return[r("div",{staticClass:"kb-col__board"},[r("draggable",t._b({model:{value:e.datalist,callback:function(r){t.$set(e,"datalist",r)},expression:"reject.datalist"}},"draggable",t.dragOptions,!1),[r("transition-group",{attrs:{tag:"ul"}},t._l(e.datalist,(function(e){var a=e.id,s=e.t_title,n=e.t_rank,i=e.t_content,o=e.t_header_name,c=e.end_time,l=e.is_done;return r("li",{key:a,staticClass:"kb-col__item",attrs:{"data-border":t.rankColor(l,n)},on:{click:function(e){return t.showDetail(a)}}},[r("div",{staticClass:"boardItem",class:{done:l},domProps:{innerHTML:t._s(s)}}),r("div",{staticClass:"text-sm text-gray-500 boardItem",class:{done:l}},[t._v(" "+t._s(i)+" ")]),r("div",{staticClass:"mt-1 flex items-center text-xs"},[r("div",{staticClass:"mr-2 flex items-center"},[null!==c?r("feather",{staticClass:"mr-1",attrs:{size:"12",type:"clock"}}):t._e(),null!==c?r("span",[t._v(" "+t._s(t._f("dateFormat")(c)))]):t._e()],1),r("div",{staticClass:"ml-auto flex-1 flex flex-wrap justify-end"},[r("a-avatar",{key:a,staticClass:"kb-col__avatar text-xs primary bg-primary-light",attrs:{size:30}},[t._v(t._s(null===o?"暂无":o))])],1)])])})),0)],1)],1)]}}])})],1)],1),r("task",{attrs:{"pop-visible":t.showTask,detail:"detailTaskId"},on:{close:function(e){t.showTask=!1}}}),r("add-modal")],1)])}),[],!1,null,"531253a9",null).exports,v={name:"Kanban",components:{TaskList:r("72e5").default,draggable:n.a,FilterModal:g.a,Task:p.a,MemberList:k,AddModal:i.a},data:function(){return{labelCol:{span:6},wrapperCol:{span:14},state:{},dragOptions:{animation:200,group:"description",disabled:!0,ghostClass:"ghost"},currAdd:{id:"",title:"",content:""},rules:{s_title:[{required:!0,message:"请输入名称",trigger:"blur"}],s_start_time:[{required:!0,message:"请选择日期",trigger:"change"}],s_end_time:[{required:!0,message:"请选择日期",trigger:"change"}]},showTask:!1,showMember:!1,showList:!1,isTaskShow:!0,isKbShow:!0,isEditStageVisible:!1,newStage:{s_id:"",pro_id:"",s_title:"",s_target:"",s_start_time:null,s_end_time:null},currEditStage:{s_id:"",pro_id:"",s_title:"",s_target:"",s_start_time:null,s_end_time:null},isAddStageVisible:!1}},created:function(){this.init()},watch:{currStage:function(){this.init()},currProjectID:function(){this.init()},showTask:function(){this.init()},showMember:function(){this.init()},isAddModalOpened:function(){this.init()},currListType:function(){this.init()}},methods:{consoleBoard:function(){},moment:c.a,dateformat:_.a,init:function(){this.getStageList(),this.getStage(),this.getBoardList(),this.getMemberList(),this.$store.commit("add/SET_ADD_MODAL_TYPE","task")},getStage:function(){var t=this;return Object(a.a)(regeneratorRuntime.mark((function e(){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(l.b)(t.currStageId);case 2:return r=e.sent,a=r.data,t.$store.commit("stage/SET_CURR_STAGE",a),t.$store.commit("stage/SET_CURR_STAGE_ID",a.s_id),t.$store.commit("stage/SET_CURR_STAGE_NAME",a.s_title),t.currEditStage=a,e.abrupt("return",!0);case 9:case"end":return e.stop()}}),e)})))()},getStageList:function(){var t=this;return Object(a.a)(regeneratorRuntime.mark((function e(){var r,a,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.currProjectID,e.next=3,Object(l.c)(r);case 3:return a=e.sent,s=a.data,t.$store.commit("stage/SET_STAGE_LIST",s.stagelist),e.abrupt("return",!0);case 7:case"end":return e.stop()}}),e)})))()},addNewBoard:function(){this.taskList.push({title:"默认标题",dataList:[]})},addNewItem:function(){var t=this;this.currAdd.content.length>0&&this.taskList.some((function(e){return e.title===t.currAdd.title&&(e.dataList.push({id:"10086",content:t.currAdd.content}),t.reset(),!0)}))},deleteBoard:function(t){var e=this,r=this.$createElement;this.$confirm({title:r("p",["此操作将删除",r("span",{class:"warning"},["「",t,"」"]),"看板"]),content:"请点击确定按钮以删除",onOk:function(){e.taskList.some((function(e,r,a){return e.title===t&&(a.splice(r,1),!0)}))}})},orderList:function(){this.list=this.list.sort((function(t,e){return t.order-e.order}))},onMove:function(t){var e=t.relatedContext,r=t.draggedContext,a=e.element,s=r.element;return!(a&&a.fixed||s.fixed)},delTask:function(t,e){this.dragList[t].list.splice(e,1)},delStage:function(t){this.dragList.splice(t,1)},changeStageTo:function(t,e){this.$store.commit("stage/SET_CURR_STAGE_NAME",e),this.$store.commit("stage/SET_CURR_STAGE_ID",t),window.localStorage.setItem("currStageId",t),window.localStorage.setItem("currStage",e),window.localStorage.setItem("currStageId",t),this.init()},target:function(){var t=this.$createElement;this.$info({title:"迭代目标：",content:t("div",{},[t("h3",this.stageList[window.localStorage.getItem("currStageId")].target)]),onOk:function(){}})},onChange:function(t){var e=t.target;switch(this.isKbShow=!1,this.showList=!1,this.showMember=!1,e.value){case"kanban":this.isKbShow=!0,this.showKbBoard();break;case"list":this.showList=!0,this.showListBoard();break;case"board":this.consoleBoard();break;case"member":this.showMember=!0;break;case"progress":default:return!0}return!1},showKbBoard:function(t){"task"===t&&(this.isTaskShow=!0,this.$store.commit("add/SET_ADD_MODAL_TYPE","task")),"bug"===t&&(this.isTaskShow=!1,this.$store.commit("add/SET_ADD_MODAL_TYPE","bug")),this.getBoardList(),this.$store.commit("filter/SET_FILTER_MODAL_TYPE",t),this.currShow=t},showListBoard:function(){this.$store.commit("task/SET_LIST_TYPE","stage")},onOpenFilter:function(t){this.$store.commit("filter/SET_FILTER_MODAL_TYPE",t),this.$store.commit("filter/SET_FILTER_MODAL_STATUS",!0)},addStage:function(){this.$store.commit("stage/SET_STAGE_List",this.newStage),this.isAddStageVisible=!1,this.init()},handleStage:function(t){switch(t.key){case"edit":this.openEditModal();break;case"delete":this.opendeleteModal();break;default:return!1}return!0},closeAddStage:function(){this.isAddStageVisible=!1},onStageDateChange:function(t,e){var r=e.start,a=e.end;this.newStage.start=r,this.newStage.end=a},openEditModal:function(){this.currEditStage.s_id=this.stage.s_id,this.currEditStage.s_title=this.stage.s_title,this.currEditStage.s_target=this.stage.s_target,this.currEditStage.start=Object(_.a)(this.stage.s_start_time),this.currEditStage.end=Object(_.a)(this.stage.s_end_time),this.isEditStageVisible=!0},openDeleteModal:function(t){var e=this.$createElement,r=this;this.$confirm({title:e("p",["此操作将删除",e("span",{class:"warning"},["「",t,"」"]),"项目"]),content:"您确定要删除该项目吗？",onOk:function(){return Object(a.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(l.a)({title:t});case 2:if(200===e.sent.meta.status){e.next=5;break}return e.abrupt("return",r.$message.error("删除项目失败"));case 5:return r.$message.success("删除项目成功！"),r.getStage(),e.abrupt("return",!0);case 8:case"end":return e.stop()}}),e)})))()}})},editStage:function(t){var e=this;return Object(a.a)(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if("add"!==t){r.next=4;break}e.$refs.addFormRef.validate(function(){var t=Object(a.a)(regeneratorRuntime.mark((function t(r,a){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r){t.next=2;break}return t.abrupt("return",e.$message.error("存在错误字段，无法创建"));case 2:if(!e.newStage.s_start_time||!e.newStage.s_end_time){t.next=6;break}if(!(e.newStage.s_start_time-e.newStage.s_end_time>0)){t.next=6;break}return e.$message.warning("截止时间早于开始时间！"),t.abrupt("return",!1);case 6:return e.newStage.s_start_time&&(e.newStage.s_start_time=Object(_.b)(e.newStage.s_start_time.format("YYYY-MM-DD h:m:s"))),e.newStage.s_end_time&&(e.newStage.s_end_time=Object(_.b)(e.newStage.s_end_time.format("YYYY-MM-DD h:m:s"))),e.newStage.pro_id=e.currProjectID,t.next=11,Object(l.d)(e.newStage);case 11:if(200===t.sent.meta.status){t.next=14;break}return t.abrupt("return",e.$message.error("创建项目失败"));case 14:return e.$message.success("创建项目成功！"),e.$refs.addFormRef.resetFields(),e.isAddStageVisible=!1,e.init(),t.abrupt("return",!0);case 19:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}()),r.next=21;break;case 4:if(!e.currEditStage.s_start_time||!e.currEditStage.s_end_time){r.next=8;break}if(!(e.currEditStage.s_start_time-e.currEditStage.s_end_time>0)){r.next=8;break}return e.$message.warning("截止时间早于开始时间！"),r.abrupt("return",!1);case 8:return e.currEditStage.s_start_time&&(e.currEditStage.s_start_time=Object(_.b)(e.currEditStage.s_start_time.format("YYYY-MM-DD h:m:s"))),e.currEditStage.s_end_time&&(e.currEditStage.s_end_time=Object(_.b)(e.currEditStage.s_end_time.format("YYYY-MM-DD h:m:s"))),e.currEditStage.pro_id=e.currProjectID,r.next=13,Object(l.e)(e.currEditStage);case 13:if(200===r.sent.meta.status){r.next=16;break}return r.abrupt("return",e.$message.error("编辑项目失败"));case 16:return e.$message.success("编辑项目成功！"),e.currEditStage={s_id:"",pro_id:"",s_title:"",s_target:"",s_start_time:null,s_end_time:null},e.isEditStageVisible=!1,e.init(),r.abrupt("return",!0);case 21:return r.abrupt("return",!1);case 22:case"end":return r.stop()}}),r)})))()},getBoardList:function(){var t=this;return Object(a.a)(regeneratorRuntime.mark((function e(){var r,a,s,n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.currProjectID,a=t.currStageId,s=!0===t.isTaskShow?1:0,e.next=5,Object(u.e)(r,a,s);case 5:return n=e.sent,i=n.data,t.$store.commit("task/SET_BOARD_LIST",i),e.abrupt("return",!0);case 9:case"end":return e.stop()}}),e)})))()},getTaskDetail:function(t){var e=this;return Object(a.a)(regeneratorRuntime.mark((function r(){var a,s,n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=e.currProjectID,r.next=3,Object(u.h)(a,t);case 3:return s=r.sent,n=s.data,e.$store.commit("task/SET_TASK_DETAIL",n),0!==n.detail.t_level&&e.$store.commit("task/SET_CURR_FATHER_TASK",n.parent[0]),r.abrupt("return",!0);case 8:case"end":return r.stop()}}),r)})))()},getDialog:function(t){var e=this;return Object(a.a)(regeneratorRuntime.mark((function r(){var a,s,n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a={pid:e.currProjectID,source:"task",sid:t},r.next=3,Object(m.a)(a);case 3:return s=r.sent,n=s.data,e.$store.commit("task/SET_TASK_DIALOG",n),r.abrupt("return",!0);case 7:case"end":return r.stop()}}),r)})))()},showDetail:function(t){var e=this;return Object(a.a)(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return e.$store.commit("task/SET_CURR_EDIT_TASK",t),r.next=3,e.getTaskDetail(t);case 3:return r.next=5,e.getDialog(t);case 5:return r.next=7,e.getComment(t);case 7:e.showTask=!0;case 8:case"end":return r.stop()}}),r)})))()},getComment:function(t){var e=this;return Object(a.a)(regeneratorRuntime.mark((function r(){var a,s,n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a={source:"task",sid:t},r.next=3,Object(d.a)(a);case 3:return s=r.sent,n=s.data,e.$store.commit("task/SET_TASK_COMMENT",n),r.abrupt("return",!0);case 7:case"end":return r.stop()}}),r)})))()},getMemberList:function(){var t=this;return Object(a.a)(regeneratorRuntime.mark((function e(){var r,a,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.currProjectID,e.next=3,Object(f.a)(r);case 3:a=e.sent,s=a.data,t.$store.commit("team/SET_CURR_PROJECT_MEMBER_LIST",s);case 6:case"end":return e.stop()}}),e)})))()},deleteTask:function(t){var e=this;return Object(a.a)(regeneratorRuntime.mark((function r(){var a;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,Object(u.b)(t);case 3:a=r.sent,e.$message.success(a.meta.msg),e.getTask(),r.next=10;break;case 8:r.prev=8,r.t0=r.catch(0);case 10:return r.abrupt("return",!0);case 11:case"end":return r.stop()}}),r,null,[[0,8]])})))()},onOpenAdd:function(){this.$store.commit("add/SET_ADD_FROM_DETAIL",!1),this.$store.commit("add/SET_ADD_MODAL_TYPE",1===this.isTaskShow?"task":"bug"),this.$store.commit("add/SET_ADD_MODAL_STATUS",!0)},rankColor:function(t,e){if(t)return"side-menu-icon-color";switch(e){case 1:return"success";case 2:return"warning";case 3:return"danger";default:return""}}},computed:{currProjectID:function(){return this.$store.state.project.currProjectId},currStage:function(){return this.$store.state.stage.currStage},currStageId:function(){return this.$store.state.stage.currStageId},stage:function(){return this.$store.state.stage.currStageInfo},stageList:function(){return this.$store.state.stage.stageList},isFilterModalOpened:function(){return this.$store.state.filter.isFilterModalOpened},isAddModalOpened:function(){return this.$store.state.add.isAddModalOpened},currFilterType:function(){return this.$store.state.filter.currFilterType},taskList:function(){return this.$store.state.task.taskList},boardList:function(){return this.$store.state.task.boardList},board:function(){return this.$store.getters["add/boardInit"]}}},S=(r("bbf8"),Object(b.a)(v,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"kanban"},[r("div",{staticClass:" -mt-8 w-full pr-3"},[r("div",{staticClass:" no-scroll w-full p-2 title-card"},[r("div",{staticClass:"wl"},[r("div",{staticClass:"wl"},[r("div",{staticClass:"wl mr-2 mt-1"},[r("a-button",{staticClass:"text-xl",on:{click:function(e){t.isAddStageVisible=!0}}},[t._v("+")])],1),r("div",{staticClass:"wl"},[r("a-dropdown",{staticClass:" mr-26",attrs:{trigger:["click"]},scopedSlots:t._u([{key:"overlay",fn:function(){return[r("a-menu",{staticClass:"-ml-1"},t._l(t.stageList,(function(e){var a=e.s_id,s=e.s_title;return r("a-menu-item",{key:a,staticStyle:{"font-size":"15px"},on:{click:function(e){return t.changeStageTo(a,s)}}},[t._v(" "+t._s(s)+" ")])})),1)]},proxy:!0}])},[r("div",{staticClass:" text-2xl ml-1 flex items-center cursor-pointer "},[r("h3",{staticClass:"section-card__title"},[t._v(" "+t._s(t.stage.s_title)+" ")]),r("feather",{staticClass:"ml-1 text-gray-500",attrs:{size:"18",type:"chevron-down"}})],1)])],1),r("div",{staticClass:"wl"},[r("feather",{staticClass:"text-xl ml-2 text-gray-500",staticStyle:{cursor:"pointer",color:"#98adf9"},attrs:{size:"18",type:"bookmark"},on:{click:t.target}}),r("div",{staticClass:" flex-no-wrap inline-block ",staticStyle:{color:"#bdc0c9","white-space":"nowrap",width:"30px","margin-top":"7px"}},[t._v(" "+t._s(t._f("dateFormat")(t.stage.s_start_time))+"~"+t._s(t._f("dateFormat")(t.stage.s_end_time))+" ")])],1)])]),r("div",{staticClass:"wr"},[r("div",{staticClass:"wr ml-2 mt-1"},[r("a-dropdown",[r("a-menu",{attrs:{slot:"overlay",placement:"bottomRight"},on:{click:t.handleStage},slot:"overlay"},[r("a-menu-item",{key:"edit"},[t._v(" 编辑迭代 ")]),r("a-menu-item",{key:"delete"},[t._v(" 删除迭代 ")])],1),r("a-button",{staticStyle:{"margin-left":"8px"}},[t._v(" 更多 "),r("a-icon",{attrs:{type:"down"}})],1)],1)],1),r("div",{staticClass:"wr mt-1 mr-2"},[r("a-radio-group",{attrs:{"default-value":"kanban"},on:{change:t.onChange}},[r("a-radio-button",{attrs:{value:"kanban"}},[t._v("看板")]),r("a-radio-button",{attrs:{value:"list"}},[t._v("列表")]),r("a-radio-button",{attrs:{value:"board"}},[t._v("仪表盘")]),r("a-radio-button",{attrs:{value:"member"}},[t._v("成员")]),r("a-radio-button",{attrs:{value:"progress"}},[t._v("进度图")])],1)],1)])])]),t.isKbShow?r("div",[r("div",[r("a-button",{staticClass:"inline mb-4",attrs:{size:"large",type:"primary"},on:{click:function(e){return t.onOpenAdd()}}},[t._v("创建"+t._s(t.isTaskShow?"需求":"缺陷"))]),r("div",{staticClass:"ml-4 inline"},[r("a-radio-group",{attrs:{"default-value":"task"}},[r("a-radio-button",{attrs:{value:"task"},on:{click:function(e){return t.showKbBoard("task")}}},[t._v("需求")]),r("a-radio-button",{attrs:{value:"bug"},on:{click:function(e){return t.showKbBoard("bug")}}},[t._v("缺陷")])],1)],1)],1),r("div",{staticClass:"kb"},[t._l(t.boardList,(function(e,a){return r("div",{key:a,staticClass:"kb-col"},[r("div",{staticClass:"kb-col__title overflow-hidden mb-1 flex items-center"},[r("span",{staticClass:"kb-col__input"},[r("span",{staticClass:"ml-4"},[t._v(t._s(e.state)+" · "+t._s(e.datalist.length))])])]),r("div",{staticClass:"kb-col__board"},[r("draggable",t._b({model:{value:e.datalist,callback:function(r){t.$set(e,"datalist",r)},expression:"it.datalist"}},"draggable",t.dragOptions,!1),[r("transition-group",{attrs:{tag:"ul"}},t._l(e.datalist,(function(e){var a=e.id,s=e.t_rank,n=e.t_title,i=e.t_content,o=e.t_header_name,c=e.end_time,l=e.is_done;return r("li",{key:a,staticClass:"kb-col__item",attrs:{"data-border":t.rankColor(l,s)},on:{click:function(e){return t.showDetail(a)}}},[r("div",{staticClass:"boardItem",class:{done:l},domProps:{innerHTML:t._s(n)}}),r("div",{staticClass:"text-sm text-gray-500 boardItem",class:{done:l}},[t._v(" "+t._s(i)+" ")]),r("div",{staticClass:"mt-1 flex items-center text-xs"},[r("div",{staticClass:"mr-2 flex items-center"},[null!==c?r("feather",{staticClass:"mr-1",attrs:{size:"12",type:"clock"}}):t._e(),null!==c?r("span",[t._v(" "+t._s(t._f("dateFormat")(c)))]):t._e()],1),r("div",{staticClass:"ml-auto flex-1 flex flex-wrap justify-end"},[r("a-avatar",{key:a,staticClass:"kb-col__avatar text-xs primary bg-primary-light",attrs:{size:30}},[t._v(t._s(null===o?"暂无":o))])],1)])])})),0)],1)],1)])})),t.boardList?t._e():r("div",{staticClass:"flex flex-no-wrap flex-shrink-0 inline-block overflow-x-scroll",staticStyle:{"white-space":"nowrap"}},t._l(t.board,(function(e,a){return r("div",{key:-a-1,staticClass:"kb-col"},[r("div",{staticClass:"kb-col__title overflow-hidden mb-1 flex items-center"},[r("span",{staticClass:"kb-col__input"},[r("span",{staticClass:"ml-4"},[t._v(t._s(e.state)+" · "+t._s(e.datalist.length))])])]),r("div",{staticClass:"kb-col__board"},[r("draggable",t._b({model:{value:e.datalist,callback:function(r){t.$set(e,"datalist",r)},expression:"it.datalist"}},"draggable",t.dragOptions,!1))],1)])})),0)],2)]):t._e(),t.showList?r("div",{staticClass:"mt-10"},[r("task-list")],1):t._e(),t.showMember?r("div",{staticClass:"mt-10"},[r("member-list")],1):t._e(),r("filter-modal"),r("add-modal"),r("task",{attrs:{"pop-visible":t.showTask,detail:"detailTaskId"},on:{close:function(e){t.showTask=!1}}}),r("a-modal",{attrs:{visible:t.isAddStageVisible,title:"创建迭代"},on:{ok:function(e){return t.editStage("add")},cancel:t.closeAddStage}},[r("div",[r("a-form-model",{ref:"addFormRef",staticClass:"pl-2",attrs:{layout:"horizontal",model:t.newStage,rules:t.rules,"label-col":t.labelCol,"wrapper-col":t.wrapperCol}},[r("a-form-model-item",{attrs:{label:"迭代名称",type:"name",prop:"s_title"}},[r("a-input",{model:{value:t.newStage.s_title,callback:function(e){t.$set(t.newStage,"s_title",e)},expression:"newStage.s_title"}})],1),r("a-form-model-item",{attrs:{label:"开始日期",prop:"s_start_time"}},[r("a-date-picker",{staticStyle:{width:"100%"},attrs:{format:"YYYY/MM/DD",type:"date",placeholder:"开始日期"},model:{value:t.newStage.s_start_time,callback:function(e){t.$set(t.newStage,"s_start_time",e)},expression:"newStage.s_start_time"}})],1),r("a-form-model-item",{attrs:{label:"截止日期",prop:"s_end_time"}},[r("a-date-picker",{staticStyle:{width:"100%"},attrs:{format:"YYYY/MM/DD",type:"date",placeholder:"截止日期"},model:{value:t.newStage.s_end_time,callback:function(e){t.$set(t.newStage,"s_end_time",e)},expression:"newStage.s_end_time"}})],1),r("a-form-model-item",{attrs:{label:"迭代目标"}},[r("a-input",{attrs:{type:"textarea"},model:{value:t.newStage.s_target,callback:function(e){t.$set(t.newStage,"s_target",e)},expression:"newStage.s_target"}})],1)],1)],1)]),r("a-modal",{attrs:{visible:t.isEditStageVisible,title:"编辑迭代"},on:{ok:function(e){return t.editStage("edit")},cancel:function(e){t.isEditStageVisible=!1}}},[r("div",[r("a-form-model",{staticClass:"pl-2",attrs:{layout:"horizontal",model:t.currEditStage,"label-col":t.labelCol,"wrapper-col":t.wrapperCol}},[r("a-form-model-item",{ref:"name",attrs:{label:"迭代名称",type:"name"}},[r("a-input",{model:{value:t.currEditStage.s_title,callback:function(e){t.$set(t.currEditStage,"s_title",e)},expression:"currEditStage.s_title"}})],1),r("a-form-model-item",{attrs:{label:"起止日期",prop:"date"}},[r("a-date-picker",{staticStyle:{width:"100%"},attrs:{format:"YYYY/MM/DD",type:"date",placeholder:"开始日期"},model:{value:t.currEditStage.s_start_time,callback:function(e){t.$set(t.currEditStage,"s_start_time",e)},expression:"currEditStage.s_start_time"}}),r("a-date-picker",{staticStyle:{width:"100%"},attrs:{format:"YYYY/MM/DD",type:"date",placeholder:"截止日期"},model:{value:t.currEditStage.s_end_time,callback:function(e){t.$set(t.currEditStage,"s_end_time",e)},expression:"currEditStage.s_end_time"}})],1),r("a-form-model-item",{attrs:{label:"迭代目标"}},[r("a-input",{attrs:{type:"textarea"},model:{value:t.currEditStage.s_target,callback:function(e){t.$set(t.currEditStage,"s_target",e)},expression:"currEditStage.s_target"}})],1)],1)],1)])],1)}),[],!1,null,"6711bcb5",null));e.default=S.exports}}]);