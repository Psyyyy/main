(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-0ef62076"],{"2be1":function(e,t,a){"use strict";a.r(t);var r=a("9139"),s=(a("6c00"),a("b6b7")),i=(a("ef25"),a("4052")),o=a("4de3");var n={name:"AvatarUpload",components:{VueCropper:i.VueCropper},props:{preview:{type:Boolean,default:!1}},data:function(){return{avatarInfo:null,avatarBase64:"",uploading:!1,showPreview:!1,previews:{},previewStyle1:null,previewStyle2:null}},methods:{beforeUpload:function(e){var t=this;if(e.size<2097152){var a=new FileReader;a.readAsDataURL(e),a.onload=function(a){var r=a.target.result;t.avatarInfo=e,t.avatarBase64=r,t.preview&&(t.showPreview=!0)}}else this.$message.error("图片大小不能超过 2MB！");return!1},realTime:function(e){this.previews=e;var t={width:"".concat(e.w,"px"),height:"".concat(e.h,"px"),overflow:"hidden",borderRadius:"9999px",boxShadow:"0 0 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)"};this.previewStyle1=Object(s.a)(Object(s.a)({},t),{},{zoom:250/e.w}),this.previewStyle2=Object(s.a)(Object(s.a)({},t),{},{zoom:150/e.w})},handleUpload:function(){var e=this;this.uploading=!0,this.$refs.cropper.getCropBlob((function(t){var a;(new FormData).append("avatar",t,e.avatarInfo.avatar),Object(o.a)({url:"/common/image",method:"post",data:a}).then((function(){e.$message.success("头像上传成功")})).finally((function(){e.uploading=!1}))}))}}},l=a("2ca5"),c=Object(l.a)(n,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"flex items-end"},[a("vue-cropper",{ref:"cropper",staticStyle:{width:"300px",height:"300px"},attrs:{"output-type":"jpeg",mode:"cover",info:!1,"output-size":.8,"can-move":!1,"can-move-box":!0,"can-scale":!0,"auto-crop":!0,"center-box":!0,fixed:!0,"info-true":!0,img:e.avatarBase64},on:{realTime:e.realTime}}),e.showPreview?a("div",{staticClass:"ml-8 text-center"},[a("div",{style:e.previewStyle1},[a("div",{style:e.previews.div},[a("img",{staticStyle:{"max-width":"initial"},style:e.previews.img,attrs:{alt:"头像预览",src:e.previews.url}})])]),a("p",{staticClass:"mt-4 text-gray-600"},[e._v("250 X 250")])]):e._e(),e.showPreview?a("div",{staticClass:"ml-8 text-center"},[a("div",{style:e.previewStyle2},[a("div",{style:e.previews.div},[a("img",{staticStyle:{"max-width":"initial"},style:e.previews.img,attrs:{alt:"头像预览",src:e.previews.url}})])]),a("p",{staticClass:"mt-4 text-gray-600"},[e._v("150 X 150")])]):e._e()],1),a("div",{staticClass:"mt-6 flex items-center"},[a("a-upload",{staticClass:"avatar-upload",attrs:{accept:"image/*","show-upload-list":!1,"before-upload":e.beforeUpload}},[a("a-button",[e._v("选择图片")])],1),a("a-button",{staticClass:"ml-4",attrs:{type:"primary",disabled:!e.avatarInfo,loading:e.uploading},on:{click:e.handleUpload}},[e._v(" "+e._s(e.uploading?"正在上传":"开始上传")+" ")])],1)])}),[],!1,null,null,null).exports,u=a("b8fb"),m=a.n(u),p=a("5ae0"),f={name:"Account",components:{AvatarUpload:c},data:function(){return{form:{},avatarUploadVisible:!1}},computed:{info:function(){return this.$store.state.user.info},currUserID:function(){return window.sessionStorage.getItem("currUserID")}},created:function(){this.init()},methods:{init:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getUserInfo(e.currUserID);case 2:e.form=m()(e.info);case 3:case"end":return t.stop()}}),t)})))()},resetForm:function(){this.form=m()(this.info)},updateUser:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.form.role="管理员"===e.form.role?"admin":"normal",t.next=3,Object(p.e)(e.form);case 3:if(200===t.sent.meta.status){t.next=6;break}return t.abrupt("return",e.$message.error("更新失败"));case 6:return e.$message.success("更新成功！"),e.init(),t.abrupt("return",!0);case 9:case"end":return t.stop()}}),t)})))()},getUserInfo:function(e){var t=this;return Object(r.a)(regeneratorRuntime.mark((function a(){var r,s;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Object(p.a)(e);case 2:r=a.sent,s=r.data,t.$store.commit("user/SET_USER_INFO",s.info);case 5:case"end":return a.stop()}}),a)})))()}}},d=(a("bb6c"),Object(l.a)(f,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"flex items-center"},[a("a-avatar",{attrs:{size:80,src:e.info.avatar}}),a("div",{staticClass:"ml-4"},[a("div",{staticClass:"mb-2 text-xl"},[e._v(e._s(e.info.name))]),a("div",[a("a-button",{staticClass:"ml-1 text-xs"},[e._v("重置")])],1)])],1),a("div",{staticClass:"my-8"},[a("a-form",{staticClass:"account-form",attrs:{"hide-required-mark":"",form:e.form}},[a("a-form-item",{key:1,staticClass:"account-form__item",attrs:{label:"昵称"}},[a("a-input",{staticClass:"login-input",attrs:{placeholder:""},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),a("a-form-item",{key:2,staticClass:"account-form__item",attrs:{label:"电话"}},[a("a-input",{staticClass:"login-input",attrs:{placeholder:""},model:{value:e.form.mobile,callback:function(t){e.$set(e.form,"mobile",t)},expression:"form.mobile"}})],1),a("a-form-item",{key:3,staticClass:"account-form__item",attrs:{label:"邮箱"}},[a("a-input",{staticClass:"login-input",attrs:{placeholder:""},model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}})],1),a("a-form-item",{key:4,staticClass:"account-form__item",attrs:{label:"职位"}},[a("a-input",{staticClass:"login-input",attrs:{placeholder:""},model:{value:e.form.job,callback:function(t){e.$set(e.form,"job",t)},expression:"form.job"}})],1)],1)],1),a("div",{staticClass:"mt-6 flex justify-end"},[a("a-button",{staticClass:"mr-4",attrs:{size:"large",type:"primary"},on:{click:e.updateUser}},[e._v("保存更改")]),a("a-button",{attrs:{size:"large"},on:{click:e.resetForm}},[e._v("取消")])],1),a("a-modal",{attrs:{centered:"",title:"更改头像","mask-closable":!1,footer:null},model:{value:e.avatarUploadVisible,callback:function(t){e.avatarUploadVisible=t},expression:"avatarUploadVisible"}},[a("avatar-upload")],1)],1)}),[],!1,null,"152c0c5c",null));t.default=d.exports},"6ea7":function(e,t,a){},bb6c:function(e,t,a){"use strict";a("6ea7")}}]);