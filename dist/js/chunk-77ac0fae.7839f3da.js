(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-77ac0fae"],{"3e19":function(t,e,r){},7681:function(t,e,r){"use strict";r.r(e);var a=r("9139"),n=(r("6c00"),r("bd40")),s=r("04ff"),o=r("8c48"),i=r("d3ae"),c=r("89b9"),u={name:"Notice",components:{Task:r("6f42").a,AddModal:c.a},data:function(){return{showTask:!1}},computed:{noticeList:function(){return this.$store.state.notice.noticeList},currUserID:function(){return window.sessionStorage.getItem("currUserID")},currProjectID:function(){return this.$store.state.project.currProjectId},isAddModalOpened:function(){return this.$store.state.add.isAddModalOpened},currListType:function(){return this.$store.state.task.currListType},currStageId:function(){return this.$store.state.stage.currStageId}},created:function(){this.getNoticeList()},methods:{closeDetail:function(){this.showTask=!1},onOpenAdd:function(){this.$store.commit("add/SET_ADD_FROM_DETAIL",!1),this.$store.commit("add/SET_ADD_MODAL_TYPE","task"),this.$store.commit("add/SET_ADD_MODAL_STATUS",!0)},resetTable:function(){this.getTask()},getTaskDetail:function(t){var e=this;return Object(a.a)(regeneratorRuntime.mark((function r(){var a,s,o;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=e.currProjectID,r.next=3,Object(n.h)(a,t);case 3:return s=r.sent,o=s.data,e.$store.commit("task/SET_TASK_DETAIL",o),0!==o.detail.t_level&&e.$store.commit("task/SET_CURR_FATHER_TASK",o.parent[0]),r.abrupt("return",!0);case 8:case"end":return r.stop()}}),r)})))()},getDialog:function(t){var e=this;return Object(a.a)(regeneratorRuntime.mark((function r(){var a,n,s;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a={pid:e.currProjectID,source:"task",sid:t},r.next=3,Object(o.a)(a);case 3:return n=r.sent,s=n.data,e.$store.commit("task/SET_TASK_DIALOG",s),r.abrupt("return",!0);case 7:case"end":return r.stop()}}),r)})))()},getComment:function(t){var e=this;return Object(a.a)(regeneratorRuntime.mark((function r(){var a,n,o;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a={source:"task",sid:t},r.next=3,Object(s.a)(a);case 3:return n=r.sent,o=n.data,e.$store.commit("task/SET_TASK_COMMENT",o),r.abrupt("return",!0);case 7:case"end":return r.stop()}}),r)})))()},showDetail:function(t,e){var r=this;return Object(a.a)(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,r.haveReadOne(e);case 2:return r.$store.commit("task/SET_CURR_EDIT_TASK",t),a.next=5,r.getTaskDetail(t);case 5:return a.next=7,r.getDialog(t);case 7:return a.next=9,r.getComment(t);case 9:r.showTask=!0;case 10:case"end":return a.stop()}}),a)})))()},getNoticeList:function(){var t=this;return Object(a.a)(regeneratorRuntime.mark((function e(){var r,a,n,s,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=window.sessionStorage.getItem("currUserID"),e.next=3,Object(i.a)(r);case 3:for(a=e.sent,n=a.data,t.$store.commit("notice/SET_NOTICE_LIST",n),s=!1,o=0;o<n.length;o+=1)0===n[o].is_read&&(s=!0);return t.$store.commit("notice/SET_NOTICE_STATUS",s),e.abrupt("return",!0);case 10:case"end":return e.stop()}}),e)})))()},haveReadAll:function(){var t=this;return Object(a.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(i.b)(t.currUserID);case 2:if(200===e.sent.meta.status){e.next=5;break}return e.abrupt("return",t.$message.error("全部已读失败"));case 5:return e.next=7,t.getNoticeList();case 7:return t.$message.success("已全部标为已读"),e.abrupt("return",!0);case 9:case"end":return e.stop()}}),e)})))()},haveReadOne:function(t){var e=this;return Object(a.a)(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Object(i.c)(t);case 2:return r.next=4,e.getNoticeList();case 4:return r.abrupt("return",!0);case 5:case"end":return r.stop()}}),r)})))()}}},m=(r("8499"),r("2ca5")),d=Object(m.a)(u,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("div",{staticClass:"section-card mb-8 "},[r("h3",{staticClass:"section-card__title flex items-center text-xl"},[t._v(" 全部通知 "),r("a-button",{staticClass:"ml-4 mt-1",attrs:{size:"small"},on:{click:t.haveReadAll}},[t._v(" 全部标为已读 "),r("a-icon",{attrs:{type:"check"}})],1)],1),r("div",{staticClass:"mt-2"},[r("ul",{staticClass:"notice-list "},t._l(t.noticeList,(function(e){return r("div",{key:e.id,staticClass:"px-6"},[1!==e.uid?r("a-comment",{staticClass:"notice-item",on:{click:function(r){return t.showDetail(e.sourceId,e.id)}}},[r("a",{staticClass:"text-base",attrs:{slot:"author"},slot:"author"},[t._v(" "+t._s(e.user))]),r("a-avatar",{staticClass:"bg-primary",attrs:{slot:"avatar"},slot:"avatar"},[t._v(t._s(e.user))]),r("p",{attrs:{slot:"content"},slot:"content"},[r("span",{staticClass:"warning"},[t._v(t._s(e.title))]),t._v("："+t._s(e.action)+" "),""!==e.target?r("span",{staticClass:"warning"},[t._v("「"+t._s(e.target)+"」")]):t._e()]),r("a-tooltip",{attrs:{slot:"datetime"},slot:"datetime"},[r("span",[t._v(t._s(t._f("dateFormat")(e.create)))]),0===e.read?r("span",{staticClass:"ml-3",staticStyle:{color:"#f72727","font-weight":"bold","font-style":"italic"}},[t._v("new !")]):t._e()])],1):t._e()],1)})),0)])]),r("task",{attrs:{"pop-visible":t.showTask,detail:"detailTaskId"},on:{close:function(e){t.showTask=!1}}}),r("add-modal")],1)}),[],!1,null,"36496caf",null);e.default=d.exports},8499:function(t,e,r){"use strict";r("3e19")},"89b9":function(t,e,r){"use strict";var a=r("9139"),n=(r("6c00"),r("b8fb")),s=r.n(n),o=r("0481"),i=r("bd40"),c=r("9685"),u={name:"AddModal",props:{},computed:{isAddModalOpened:function(){return this.$store.state.add.isAddModalOpened},stageList:function(){return this.$store.state.stage.stageList},currStage:function(){return this.$store.state.stage.currStage},currStageId:function(){return this.$store.state.stage.currStageId},stateAdd:function(){return this.$store.getters["add/stateAdd"]},memberList:function(){return this.$store.state.team.currProjectMemberList},currProjectID:function(){return this.$store.state.project.currProjectId},currEditTask:function(){return this.$store.state.task.currEditTask},openFrom:function(){return this.$store.state.add.isFromDetail},currEditTaskLevel:function(){return this.$store.state.task.currEditTaskLevel},currListType:function(){return this.$store.state.task.currListType},currAddType:function(){return this.$store.state.add.currAddType}},data:function(){return{currAdd:{},labelCol:{span:6},wrapperCol:{span:14},other:"",dateFormat:"YYYY/MM/DD",form:{t_pid:"",t_level:"",t_title:"",t_stage_id:"",t_stage_name:"",t_project_id:"",t_content:"",t_state:"",t_rank:"",t_header_id:"",t_header_name:"",start_time:"",end_time:""},taskStatus:["规划中","实现中","已实现","已拒绝"],rules:{t_title:[{required:!0,message:"请输入标题",trigger:"blur"}],t_stage_id:[{required:!0,message:"请选择迭代",trigger:"blur"}]},formatForm:{}}},watch:{"$store.state.add.currEditAdd":{handler:function(t){this.currAdd=s()(t)},immediate:!0}},created:function(){this.getStageList()},methods:{getStageList:function(){var t=this;return Object(a.a)(regeneratorRuntime.mark((function e(){var r,a,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.currProjectID,e.next=3,Object(c.c)(r);case 3:return a=e.sent,n=a.data,t.$store.commit("stage/SET_STAGE_LIST",n.stagelist),e.abrupt("return",!0);case 7:case"end":return e.stop()}}),e)})))()},selectHeader:function(t,e){this.form.t_header_id=t,this.form.t_header_name=e},selectStage:function(t,e){this.form.t_stage_id=t,this.form.t_stage_name=e},closeAdd:function(){this.resetForm(),this.$store.commit("add/SET_ADD_MODAL_STATUS",!1)},handleOk:function(){this.resetForm(),this.$store.commit("add/SET_ADD_MODAL_STATUS",!1)},onSubmit:function(){var t=this;return Object(a.a)(regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.formatForm=s()(t.form),!t.formatForm.start_time||!t.formatForm.end_time){e.next=5;break}if(!(t.formatForm.start_time-t.formatForm.end_time>0)){e.next=5;break}return t.$message.warning("截止时间早于开始时间！"),e.abrupt("return",!1);case 5:return t.formatForm.start_time&&(t.formatForm.start_time=Object(o.b)(t.formatForm.start_time.format("YYYY-MM-DD h:m:s"))),t.formatForm.end_time&&(t.formatForm.end_time=Object(o.b)(t.formatForm.end_time.format("YYYY-MM-DD h:m:s"))),t.formatForm.t_project_id=t.currProjectID,t.formatForm.t_pid=!0===t.openFrom?t.currEditTask:0,t.formatForm.t_level=!0===t.openFrom?t.currEditTaskLevel:0,"stage"===t.currListType&&(t.formatForm.t_stage_id=t.currStageId,t.formatForm.t_stage_name=t.currStage),"bug"===t.currAddType?(t.formatForm.t_type=0,t.formatForm.t_state="新"):t.formatForm.t_type=1,e.prev=12,e.next=15,Object(i.a)(t.formatForm);case 15:r=e.sent,r.data,t.$message.success("成功新增需求！"),t.closeAdd(),t.form={t_pid:"",t_level:"",t_title:"",t_stage_id:"",t_stage_name:"",t_project_id:"",t_content:"",t_state:"",t_rank:"",t_header_id:"",t_header_name:"",start_time:"",end_time:""},e.next=24;break;case 22:e.prev=22,e.t0=e.catch(12);case 24:return e.abrupt("return",!0);case 25:case"end":return e.stop()}}),e,null,[[12,22]])})))()},resetForm:function(){this.$refs.ruleForm.resetFields(),this.form={t_pid:"",t_level:"",t_title:"",t_stage_id:"",t_stage_name:"",t_project_id:"",t_content:"",t_state:"",t_rank:"",t_header_id:"",t_header_name:"",start_time:"",end_time:""}}}},m=r("2ca5"),d=Object(m.a)(u,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticStyle:{"z-index":"9999"}},[r("a-modal",{attrs:{visible:t.isAddModalOpened,title:"bug"===t.currAddType?"新增缺陷":"新增需求"},on:{cancel:t.closeAdd,ok:t.onSubmit}},[r("template",{slot:"footer"},[r("a-button",{key:"back",on:{click:t.resetForm}},[t._v(" 重置 ")]),r("a-button",{key:"submit",attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v(" 添加 ")])],1),r("a-form-model",{ref:"ruleForm",attrs:{model:t.form,rules:t.rules,"label-col":t.labelCol,"wrapper-col":t.wrapperCol}},[r("a-form-model-item",{ref:"t_title",attrs:{label:"标题",prop:"t_title"}},[r("a-input",{attrs:{placeholder:"请输入标题"},model:{value:t.form.t_title,callback:function(e){t.$set(t.form,"t_title",e)},expression:"form.t_title"}})],1),r("a-form-model-item",{attrs:{label:"负责人"}},[r("a-select",{attrs:{placeholder:"点击选择负责人"},model:{value:t.form.t_header_name,callback:function(e){t.$set(t.form,"t_header_name",e)},expression:"form.t_header_name"}},t._l(t.memberList,(function(e){return r("a-select-option",{key:e.uid,attrs:{value:e.name},on:{click:function(r){return t.selectHeader(e.uid,e.name)}}},[t._v(" "+t._s(e.name)+" ")])})),1)],1),"stage"!==t.currListType?r("a-form-model-item",{attrs:{label:"迭代",prop:"t_stage_id"}},[r("a-select",{attrs:{placeholder:"点击选择迭代"},model:{value:t.form.t_stage_id,callback:function(e){t.$set(t.form,"t_stage_id",e)},expression:"form.t_stage_id"}},t._l(t.stageList,(function(e){return r("a-select-option",{key:e.s_id,attrs:{value:e.s_id},on:{click:function(r){return t.selectStage(e.s_id,e.s_title)}}},[t._v(" "+t._s(e.s_title)+" ")])})),1)],1):t._e(),r("a-form-model-item",{attrs:{label:"起止日期",prop:"date"}},[r("a-date-picker",{staticStyle:{width:"100%"},attrs:{format:t.dateFormat,type:"date",placeholder:"开始日期"},model:{value:t.form.start_time,callback:function(e){t.$set(t.form,"start_time",e)},expression:"form.start_time"}}),r("a-date-picker",{staticStyle:{width:"100%"},attrs:{format:t.dateFormat,type:"date",placeholder:"截止日期"},model:{value:t.form.end_time,callback:function(e){t.$set(t.form,"end_time",e)},expression:"form.end_time"}})],1),r("a-form-item",{attrs:{label:"状态"}},[r("a-select",{attrs:{placeholder:"点击选择状态"},model:{value:t.form.t_state,callback:function(e){t.$set(t.form,"t_state",e)},expression:"form.t_state"}},t._l(t.stateAdd,(function(e){return r("a-select-option",{key:e,attrs:{value:e}},[t._v(" "+t._s(e)+" ")])})),1)],1),r("a-form-item",{attrs:{label:"优先级"}},[r("a-select",{attrs:{placeholder:"点击选择优先级"},model:{value:t.form.t_rank,callback:function(e){t.$set(t.form,"t_rank",e)},expression:"form.t_rank"}},[r("a-select-option",{attrs:{value:"1"}},[t._v(" 普通 ")]),r("a-select-option",{attrs:{value:"2"}},[t._v(" 紧急 ")]),r("a-select-option",{attrs:{value:"3"}},[t._v(" 非常紧急 ")])],1)],1)],1)],2)],1)}),[],!1,null,null,null);e.a=d.exports},9685:function(t,e,r){"use strict";r.d(e,"c",(function(){return n})),r.d(e,"b",(function(){return s})),r.d(e,"d",(function(){return o})),r.d(e,"e",(function(){return i})),r.d(e,"a",(function(){return c}));var a=r("4de3");function n(t){return Object(a.a)({url:"/stage/all/".concat(t),method:"get"})}function s(t){return Object(a.a)({url:"/stage/".concat(t),method:"get"})}function o(t){return Object(a.a)({url:"/stage/new",method:"post",data:t})}function i(t){return Object(a.a)({url:"/stage/update",method:"put",data:t})}function c(t){return Object(a.a)({url:"/stage/delete",method:"delete",data:t})}}}]);